<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
    </head>
    <body>
    <h1>Websocket</h1>
    Server topic: <span id="topic">Topic</span><br />
    <div id="message"></div>
    <input id="chat" placeholder="Chat..." />

    <script>

        var connected = false;
        var socket = null;

        function connect() {

            if (connected) {
                return true;
            }
            socket = new WebSocket("ws://localhost:1337");

            socket.onmessage = function (event) {
                var data = JSON.parse(event.data);
                console.log(data);
                document.getElementById('topic').innerHTML = data.topic;
                document.getElementById('message').innerHTML += '<p><strong>'+ data.name +':</strong><br />' + data.message + '</p>';
            };

            socket.onclose = function(event) {

                document.getElementById('message').innerHTML += '<p>You disconnected. <a href="#reconnect" onclick="connect();">Reconnect?</a></p>';
                connected = false;

            };

            return true;

        }

        function chat(message) {
            if (socket == null) {
                return false;
            }
            socket.send(JSON.stringify({topic:'chat',message:message}));
            return true;
        }

        document.getElementById('chat').addEventListener ("keydown", function (event) {
            if (event.keyCode == 13) {
                var message = document.getElementById('chat').value;
                if (chat(message)) {
                    document.getElementById('chat').value = '';
                }
                else {
                    document.getElementById('message').innerHTML += '<p>Cannot chat at the moment. Are you <a href="#reconnect" onclick="connect();">connected</a>?</p>';
                }

            }
        }, false);

    </script>
    </body>
</html>